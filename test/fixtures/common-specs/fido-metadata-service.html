<!DOCTYPE html>
<html>
<head>
  <title>FIDO Metadata Service</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <!--
  === NOTA BENE ===
  For the three scripts below, if your spec resides on dev.w3 you can check them
  out in the same tree and use relative links so that they'll work offline,
  -->
  <script src='resources/respec-fido-common.js' class='remove' async></script>
  <script type="text/javascript" class="remove">
      var respecConfig = {
        // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use ED.
        // Member-SUBM
        specStatus: "WD",
       specVersion: "v1.3",
        specFamily: "uaf",    // specFamily is here for common-specs due to release-tool publishing
                                      // and their being placed in to a release dir with whichever specFamily
                                      // at release build time -- so the value of this var in the .html files in 
                                      // common-specs repo will depend upon whichever spec family last 
                                      // built a release snapshot

      // shortName is what is termed specInRepoStemFN in..
      // https://confluence.fidoalliance.org/display/ALL/FIDO+Alliance+filenaming+and+version+labeling+conventions
        shortName:  "fido-metadata-service",

        // if your specification has a subtitle that goes below the main
        // formal title, define it here
        // subtitle   :  "an excellent document",

      // if you wish the publication date to be other than today, set this
      // NOTE: UNCOMMENT THIS PRIOR TO RUNNING release-tool/release.pl for a release, 
      //       whether internal or external (TODO: release-tool should take care of this)...
      //publishDate: "2015-09-02", 
      
      // if the specification's copyright date is a range of years, specify
      // the start date here:
      copyrightStart: "2013",
      
      // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
      // and its maturity status, OR, comment the latter two items out, and add an 
      // explicit prevVersion URI pointing to the previously publicly published version...
      //previousPublishDate: "",
      //previousMaturity: "",
        prevVersion: "https://fidoalliance.org/specs/fido-uaf-v1.0-ps-20141208/fido-uaf-metadata-service-v1.0-ps-20141208.html",

        // if there a publicly available Editor's Draft, this is the link
        edDraftURI: "",

        // if this is a LCWD, uncomment and set the end of its review period
        // lcEnd: "2009-08-05",

        // editors, add as many as you like
        // only "name" is required
        editors:  [
          { name: "Rolf Lindemann", url: "mailto:rolf@noknok.com",
            company: "Nok Nok Labs, Inc.", companyURL: "https://www.noknok.com/" }
        ],

        // authors, add as many as you like. 
        // This is optional, uncomment if you have authors as well as editors.
        // only "name" is required. Same format as editors.

        authors:  [
        { name: "Brad Hill", url: "mailto:bhill@paypal.com", company: "PayPal, Inc.", companyURL: "https://www.paypal.com/" },
	{ name: "Davit Baghdasaryan", url: "", company: "Nok Nok Labs, Inc.", companyURL: "https://www.noknok.com/" }
        ],

        // name of the WG
        wg:           "FIDO Alliance",

        // URI of the public WG page
        wgURI:        "https://fidoalliance.org/",

        // name (with the @w3c.org) of the public mailing to which comments are due
        //wgPublicList: "public-webappsec",

      };
  </script>
  <script src='resources/fido-refs.js' class='remove'></script>

</head>
<body>

<!-- only put content here if you want a custom status of document not
  the specification-maturity-appropriate boilerplate -->
<section id='sotd'></section>

<section id='abstract'>
  <p>The FIDO Authenticator Metadata Specification defines
    so-called "Authenticator Metadata" statements. The metadata statements contain
    the "Trust Anchor" required to validate the attestation object, and
    they also describe several other important characteristics of the
    authenticator.
  </p>
  <p>The metadata service described in this document
    defines a baseline method for relying parties to access the latest
    metadata statements.</p>
</section>

<section>
  <h2>Notation</h2>
  
  <p>Type names, attribute names and element names are written as <code>code</code>.
    
  <p>String literals are enclosed in “”, e.g. “UAF-TLV”.
    
  <p>In formulas we use “|” to denote byte wise concatenation
    operations.
    
  <p>
    The notation <code>base64url(byte[8..64])</code>  reads as 8-64 bytes of data
    encoded in base64url, "Base 64 Encoding with URL and Filename
    Safe Alphabet" [[!RFC4648]] <i>without padding</i>.  </p>
  
  <p>Following [[!WebIDL-ED]], dictionary members are optional unless they are 
    explicitly marked as <code>required</code>.</p>
  
  <p>WebIDL dictionary members MUST NOT have a value of null.</p>
  
  <p>Unless otherwise specified, if a WebIDL dictionary member is DOMString, 
    it MUST NOT be empty.</p>
  
  <p>Unless otherwise specified, if a WebIDL dictionary member is a List, 
    it MUST NOT be an empty list.</p>
  
  <p>UAF specific terminology used in this document is defined in
    [[FIDOGlossary]].</p>

  <p>All diagrams, examples, notes in this specification are non-normative.</p>

  <p class="note">
    Note: Certain dictionary members need to be present in order to
    comply with FIDO requirements. Such members are marked in the
    WebIDL definitions found in this document, as
    <code>required</code>. The keyword <code>required</code> has been
    introduced by [[WebIDL-ED]], which is a work-in-progress. If you
    are using a WebIDL parser which implements [[WebIDL]], then you
    may remove the keyword <code>required</code> from your WebIDL and
    use other means to ensure those fields are present.  
  </p>

  <section>
    <h3>Key Words</h3> 
    
    <p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL
      NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and
      “OPTIONAL” in this document are to be interpreted as
      described in [[RFC2119]].</p>
  </section>
</section>

<section class="informative">
  <h2>Overview</h2>

  <p>
    [[!FIDOMetadataStatement]] defines authenticator metadata statements.
  </p>
  <p>These metadata statements
    contain the trust anchor required to verify the attestation object
    (more specifically the <code>KeyRegistrationData</code> object), and they also
    describe several other important characteristics of the
    authenticator, including supported authentication and registration
    assertion schemes, and key protection flags.
  </p>
  <p>These characteristics can be used when defining policies 
    about which authenticators are acceptable for registration or
    authentication.
  </p>
  <p>The metadata service described in this document
    defines a baseline method for relying parties to access the latest
    metadata statements.
  </p>

  <figure>	  
   <img width="800" src="./img/fido-metadata-service-arch.png"
	onerror="./img/fido-metadata-service-arch.png"
	alt="FIDO Metadata Service Architecture Overview"/>
   <figcaption>FIDO Metadata Service Architecture Overview</figcaption>
  </figure>

  <section>
    <h3>Scope</h3>
    <p>
      This document describes the FIDO Metadata Service architecture in
      detail and it defines the structure and interface to access this
      service. It also defines the flow of the metadata related messages
      and presents the rationale behind the design choices. 
    </p>
  </section>

  <section>
    <h3>Detailed Architecture</h3>
    
    <p>
      The metadata "table-of-contents" (TOC) file contains a list of metadata statements 
      related to the authenticators known to the FIDO Alliance (FIDO Authenticators).
    </p>
    
    <p>
      The FIDO Server downloads the metadata TOC file from a well-known FIDO URL and caches it locally. 
    </p>
    
    <p>
      The FIDO Server verifies the integrity and authenticity of this
      metadata TOC file using the digital signature. It then iterates
      through the individual entries and loads the metadata statements
      related to authenticator AAIDs relevant to the relying party.
    </p>
    
    <p>
      Individual metadata statements will be downloaded from the URL
      specified in the entry of the metadata TOC file, and may be
      cached by the FIDO Server as required. 
    </p>
    
    <p>The integrity of the metadata statements will be verified by the
      FIDO Server using the hash value included in the related entry of the
      metadata TOC file.
    </p>
    
    <figure>	  
      <img width="800" src="./img/fido-metadata-service-arch-detail.png" 
	   alt="FIDO Metadata Service Architecture"/>
      <figcaption>FIDO Metadata Service Architecture</figcaption>
    </figure>
    
    <p class="note">The single arrow indicates the direction of the network connection, 
      the double arrow indicates the direction of the data flow.</p>
    
    <p class='note'>
      The metadata TOC file is freely accessible at a well-known URL published by the FIDO Alliance.
    </p>
    
    <p class='note'>
      The relying party decides how frequently the metadata service is accessed to check for metadata TOC updates.
    </p>
    
  </section>
</section>

<section class="normativeDisclaimer">
  <h2>Metadata Service Details</h2>

  <p class='note'>
    The relying party can decide whether it wants to use the metadata
    service and whether or not it wants to accept certain
    authenticators for registration or authentication.
  </p>

  <p>
    The relying party could also obtain metadata directly from authenticator
    vendors or other trusted sources.</p>
  </p>

  <section>
    <h3>Metadata TOC Format</h3>
    <div class="note">
      <p>The metadata service makes the metadata TOC object 
	(see <a href="#metadata-toc">Metadata TOC</a>) accessible to FIDO Servers. 
      </p>
      <p>This object is a "table-of-contents" for metadata, as it
	includes the AAID, the download URL and the hash value of
	the individual metadata statements. The TOC object
	contains one signature.  
      </p>
    </div>

    <section> 
      <h4>Metadata TOC Payload Entry dictionary</h4>
      
      <p>Represents the MetadataTOCPayloadEntry</p>
      
      <dl title='dictionary MetadataTOCPayloadEntry' class='idl'>
	<dt>AAID aaid</dt>
	<dd>
	  The AAID of the authenticator this metadata TOC payload entry relates to.
	  See [[UAFProtocol]] for the definition of the AAID structure.
	  This field MUST be set if the authenticator 
	  implements FIDO UAF.
	  <p class="note">FIDO UAF authenticators support AAID, but they don't support AAGUID.</p>	
	</dd>

	<dt>AAGUID aaguid</dt>
	<dd>The Authenticator Attestation GUID. See [[FIDOKeyAttestation]]
	  for the definition of the AAGUID structure.  This field MUST be set if the authenticator 
	  implements FIDO 2.  
	  <p class="note">FIDO 2 authenticators support AAGUID, but they don't support AAID.</p>
	</dd>
	
	<dt>DOMString[] attestationCertificateKeyIdentifiers</dt>
	<dd>A list of the attestation certificate public key identifiers encoded as hex string.  
	  This value MUST be calculated according to method 1 for computing the keyIdentifier as 
	  defined in [[RFC5280]] section 4.2.1.2.  The hex string MUST NOT contain any non-hex characters (e.g. spaces).
	  All hex letters MUST be lower case.
	  This field MUST be set if neither <code>aaid</code> nor <code>aaguid</code> are set.  Setting this field implies that
	  the attestation certificate(s) are dedicated to a single authenticator model. 
	  <p class="note">FIDO U2F authenticators do not support AAID nor AAGUID, but they use 
	    attestation certificates dedicated to a single authenticator model.
	  </p>
	</dd>
   
	<dt>required DOMString hash</dt>
	<dd><code>base64url(string[1..512])</code>
	  <p>The hash value computed over the base64url encoding of the UTF-8 
	    representation of the JSON encoded metadata statement 
	    available at <code>url</code> and as defined in [[!FIDOMetadataStatement]]. 
	    The hash algorithm related to the signature 
	    algorithm specified in the JWTHeader (see <a href="#metadata-toc">Metadata TOC</a>) 
	    MUST be used. 
	  </p>
	  <p class="note">This method of base64url encoding the UTF-8 representation is also used 
	    by JWT [[JWT]] to avoid encoding ambiguities.  
	  </p>
	</dd>

        <dt>required DOMString url</dt>
        <dd>Uniform resource locator (URL) of the encoded metadata
	  statement for this authenticator model (identified by its
	  AAID, AAGUID or attestationCertificateKeyIdentifier).  This URL MUST point to the base64url encoding of the
	  UTF-8 representation of the JSON encoded metadata statement
	  as defined in [[!FIDOMetadataStatement]].
	  <p><code>encodedMetadataStatement = base64url(utf8(JSONMetadataStatement))</code></p>
	  <p class="note">This method of the base64url encoding 
	  the UTF-8 representation is also used by JWT [[JWT]] to avoid encoding ambiguities.</p>
	</dd>

        <dt>required StatusReport[] statusReports</dt>
        <dd>An array of status reports applicable to this authenticator.</dd>
	
        <dt>required DOMString timeOfLastStatusChange</dt>
        <dd>ISO-8601 formatted date since when the status report array was set to the current value.</dd>
      </dl>

      <pre class="example" title="UAF Metadata TOC Payload">
{ "no": 1234, "nextUpdate": "2014-03-31",
  "entries": [
   { "aaid": "1234#5678", 
     "hash": "90da8da6de23248abb34da0d4861f4b30a793e198a8d5baa7f98f260db71acd4", 
     "url": "https://fidoalliance.org/metadata/1234%x23abcd", 
     "statusReports": [
                        { status: "FIDO_CERTIFIED", effectiveDate: "2014-01-04"}
                    ],
     "timeOfLastStatusChange": "2014-01-04"
     },
   { "attestationCertificateKeyIdentifiers": ["7c0903708b87115b0b422def3138c3c864e44573"],
     "hash": "785d16df640fd7b50ed174cb5645cc0f1e72b7f19cf22959052dd20b9541c64d",
     "url": "https://authnr-vendor-a.com/metadata/9876%x234321",
     "statusReports": [ 
                        { status: "FIDO_CERTIFIED", effectiveDate: "2014-01-07"},
                        { status: "UPDATE_AVAILABLE", effectiveDate: "2014-02-19", 
                          url: "https://example.com/update1234" }
                    ],
     "timeOfLastStatusChange": "2014-02-19"
     }
  ]
}
      </pre>

      <div class="note">
	<p>The character <code>#</code> is a reserved character and not allowed in URLs [[RFC3986]].  
	  As a consequence it has been replaced by its hex value <code>%x23</code>.</p>
	
	<p>
	  The authenticator vendors can decide to let the metadata service publish its 
	  metadata statements or to publish metadata statements themselves. 
	  Authenticator vendors can restrict access to the metadata statements they publish themselves.  
	</p>
      </div>

     </section>
     
     <section>
       <h4>StatusReport dictionary</h4>
       <div class="note">
	 <p>Contains an <code>AuthenticatorStatus</code> and additional data associated with it, if any.</p>
	 <p>New <code>StatusReport</code> entries will be added to report known issues present in firmware updates.</p>
       </div>
       <p>The latest <code>StatusReport</code> entry MUST reflect the "current" status. 
	 For example, if the latest entry has status
	 <code>USER_VERIFICATION_BYPASS</code>, then it is recommended assuming an increased risk associated with 
	 all authenticators of this AAID; if the latest entry has status <code>UPDATE_AVAILABLE</code>, then 
	 the update is intended to address at least all previous 
	 issues <i>reported</i> in this StatusReport dictionary.      
       </p>
       
       <dl title='dictionary StatusReport' class='idl'>
	 <dt>required AuthenticatorStatus status</dt>
	 <dd>Status of the authenticator.  Additional fields MAY be set depending on this value.</dd>
	 
	 <dt>DOMString effectiveDate</dt>
	 <dd>ISO-8601 formatted date since when the status code was set,
	   if applicable.  If no date is given, the status is assumed to be effective while present.
	 </dd>
	 
	 <dt>DOMString certificate</dt>
	 <dd>Base64-encoded [[RFC4648]] (not base64url!) DER [[ITU-X690-2008]] PKIX certificate value
	   related to the current status, if applicable.  
	   <p class="note">As an example, this could be an Attestation Root 
	     Certificate (see [[!FIDOMetadataStatement]]) related to a 
	     set of compromised authenticators (ATTESTATION_KEY_COMPROMISE).</p>
	 </dd>        
	 
	 <dt>DOMString url</dt>
	 <dd>HTTPS URL where additional information may be found related
	   to the current status, if applicable.
	   <p class="note">For example a link to a web page describing an available firmware update in the case of status 
	     <code>UPDATE_AVAILABLE</code>, or a link to a description of an identified issue in the case of 
	     status <code>USER_VERIFICATION_BYPASS</code>.
	   </p>
	 </dd>
       </dl>  
     </section>
 
     <section>
       <h4>AuthenticatorStatus enum</h4>
       <p>This enumeration describes the status of an authenticator model as identified by its
	 AAID and potentially some additional information (such as a specific attestation key).
	 
	 <dl title='enum AuthenticatorStatus' class='idl'>
	   <dt>FIDO_CERTIFIED</dt>
           <dd>This authenticator is FIDO certified.</dd>
           <dt>NOT_FIDO_CERTIFIED</dt>
           <dd>This authenticator is not FIDO certified.</dd>
	   <dt>USER_VERIFICATION_BYPASS</dt>
	   <dd>Indicates that malware is able to bypass the user verification.  
	     This means that the authenticator could be
	     used without the user's consent and potentially even without the user's knowledge.</dd>
           <dt>ATTESTATION_KEY_COMPROMISE</dt>
           <dd>Indicates that an attestation key for this authenticator is
             known to be compromised.  Additional data should be
             supplied, including the key identifier and the date of
             compromise, if known.</dd>
           <dt>USER_KEY_REMOTE_COMPROMISE</dt>
           <dd>This authenticator has identified weaknesses that allow
             registered keys to be compromised and should not be trusted.
             This would include both, e.g. weak entropy that causes
             predictable keys to be generated or side channels that allow
             keys or signatures to be forged, guessed or extracted.
           </dd>
           <dt>USER_KEY_PHYSICAL_COMPROMISE</dt>
           <dd>This authenticator has known weaknesses in its key protection
             mechanism(s) that allow user keys to be extracted by an
             adversary in physical possession of the device.
           </dd>
           <dt>UPDATE_AVAILABLE</dt>
           <dd>A software or firmware update is available for the device.
             Additional data should be supplied including a URL where
             users can obtain an update and
             the date the update was published.
	     <p>When this code is used, then the field 
	       <code>authenticatorVersion</code> in the metadata Statement [[!FIDOMetadataStatement]] MUST be updated, 
	       if the update fixes severe security issues, e.g. the ones
	       reported by preceding StatusReport entries with status code <code>USER_VERIFICATION_BYPASS</code>,
	       <code>ATTESTATION_KEY_COMPROMISE</code>, <code>USER_KEY_REMOTE_COMPROMISE</code>,
	       <code>USER_KEY_PHYSICAL_COMPROMISE</code>, <code>REVOKED</code>.</p>
	     <p class="note">Relying parties might want to inform users about available firmware updates.</p>
	   </dd>
           <dt>REVOKED</dt>
           <dd>The FIDO Alliance has determined that this authenticator
             should not be trusted for any reason, for example
             if it is known to be a fraudulent product or contain
             a deliberate backdoor.</dd>
	   <dt>SELF_ASSERTION_SUBMITTED</dt>
	   <dd>The authenticator vendor has completed and submitted the self-certification 
	     checklist to the FIDO Alliance.
	     If this completed checklist is publicly available, the URL will be 
	     specified in <code>StatusReport.url</code>.
	   </dd>
	   <dt>SECURITY_CERTIFIED</dt>
	   <dd>
	     The authenticator has passed a sanctioned third party security validation. 
	   </dd>
         </dl>

       <p>
	 More values might be added in the future.  FIDO Servers MUST silently ignore all 
	 unknown AuthenticatorStatus values.
       </p>

     </section>
     
     <section>
       <h4>RogueListEntry dictionary</h4>
       <div class="note">
	 <p>Contains a list of individual authenticators known to be rogue.</p>
	 <p>New <code>RogueListEntry</code> entries will be added to report new 
	   individual authenticators known to be rogue.
	 </p>
	 <p>Old <code>RogueListEntry</code> entries will be removed if 
	   the individual authenticator is known to not be rogue any longer.
	 </p>
       </div>
       <dl title='dictionary RogueListEntry' class='idl'>
	 <dt>required DOMString sk</dt>
	 <dd>Base64url encoding of the rogue authenticator's secret key 
	   (sk value, see [[FIDOEcdaaAlgorithm]], section ECDAA Attestation).
	   <p class="note">In order to revoke an individual authenticator, its secret key (sk) must be known.</p>
	 </dd>
	 <dt>required DOMString date</dt>
	 <dd>ISO-8601 formatted date since when this entry is effective.</dd>
       </dl>
     </section>

     <section> 
       <h4>Metadata TOC Payload dictionary</h4>
       
       <p>Represents the MetadataTOCPayload</p>
       
       <dl title='dictionary MetadataTOCPayload' class='idl'>
	 <dt>required Number no</dt>
	 <dd>The serial number of this UAF Metadata TOC Payload.  Serial numbers MUST be consecutive 
	   and strictly monotonic, i.e. the successor TOC will have a <code>no</code> value
	   exactly incremented by one.</dd>
	 
	 <dt>required DOMString nextUpdate</dt>
	 <dd>ISO-8601 formatted date when the next update will be provided at latest.</dd>
	 
	 <dt>required MetadataTOCPayloadEntry[] entries</dt>
	 <dd>List of zero or more MetadataTOCPayloadEntry objects.
	 </dd>
       </dl>
       
     </section>

     <section> 
       <h4>Metadata TOC</h4>
       
       <p>The metadata table of contents (TOC) is a JSON Web Token (see [[!JWT]] and [[!JWS]]).</p>
       <p>It consists of three elements:</p>
       <ul>
	 <li>The base64url encoding, without padding, of the UTF-8 encoded JWT Header (see example below),</li>
	 <li>the base64url encoding, without padding, of the UTF-8 encoded UAF Metadata TOC Payload (
	   see example at the beginning of section <a href="#metadata-toc-format">Metadata TOC Format</a>), </li>
	 <li>and the base64url-encoded, also without padding, JWS
	   Signature [[!JWS]] computed over the to-be-signed payload,
	   i.e.<p><code>tbsPayload = EncodedJWTHeader | "." | EncodedMetadataTOCPayload</code>
	 </li>
       </ul>
       
       <p>All three elements of the TOC are concatenated by a period ("."):</p>
       <p><code>MetadataTOC = EncodedJWTHeader | "." | EncodedMetadataTOCPayload | "." | EncodedJWSSignature</code></p>
       
       <p>The hash algorithm related to the signing algorithm specified in the JWT Header (e.g. SHA256 in the 
	 case of "ES256") MUST also be used to compute the hash of the metadata statements 
	 (see section <a href='#metadata-toc-payload-entry-dictionary'>Metadata TOC Payload Entry Dictionary</a>).
       </p>
       
       <section class="informative">
	 <h5>Examples</h5>
	 <pre class="example" title="Encoded Metadata Statement">
eyAiQUFJRCI6ICIxMjM0IzU2NzgiLA0KICAiQXR0ZXN0YXRpb25Sb290Q2VydGlmaWNhdGUiOiAi
TUlJQ1BUQ0NBZU9nQXdJQkFnSUpBT3VleHZVM095MndNQW9HQ0NxR1NNNDlCQU1DTUhzeElEQWVC
Z05WQkFNTQ0KRjFOaGJYQnNaU0JCZEhSbGMzUmhkR2x2YmlCU2IyOTBNUll3RkFZRFZRUUtEQTFH
U1VSUElFRnNiR2xoYm1ObA0KTVJFd0R3WURWUVFMREFoVlFVWWdWRmRITERFU01CQUdBMVVFQnd3
SlVHRnNieUJCYkhSdk1Rc3dDUVlEVlFRSQ0KREFKRFFURUxNQWtHQTFVRUJoTUNWVk13SGhjTk1U
UXdOakU0TVRNek16TXlXaGNOTkRFeE1UQXpNVE16TXpNeQ0KV2pCN01TQXdIZ1lEVlFRRERCZFRZ
VzF3YkdVZ1FYUjBaWE4wWVhScGIyNGdVbTl2ZERFV01CUUdBMVVFQ2d3Tg0KUmtsRVR5QkJiR3hw
WVc1alpURVJNQThHQTFVRUN3d0lWVUZHSUZSWFJ5d3hFakFRQmdOVkJBY01DVkJoYkc4Zw0KUVd4
MGJ6RUxNQWtHQTFVRUNBd0NRMEV4Q3pBSkJnTlZCQVlUQWxWVE1Ga3dFd1lIS29aSXpqMENBUVlJ
S29aSQ0KemowREFRY0RRZ0FFSDhodjJEMEhYYTU5L0JtcFE3UlplaEwvRk1HekZkMVFCZzl2QVVw
T1ozYWpudVE5NFBSNw0KYU16SDMzblVTQnI4ZkhZRHJxT0JiNThweEdxSEpSeVgvNk5RTUU0d0hR
WURWUjBPQkJZRUZQb0hBM0NMaHhGYg0KQzBJdDd6RTR3OGhrNUVKL01COEdBMVVkSXdRWU1CYUFG
UG9IQTNDTGh4RmJDMEl0N3pFNHc4aGs1RUovTUF3Rw0KQTFVZEV3UUZNQU1CQWY4d0NnWUlLb1pJ
emowRUF3SURTQUF3UlFJaEFKMDZRU1h0OWloSWJFS1lLSWpzUGtyaQ0KVmRMSWd0ZnNiRFN1N0Vy
SmZ6cjRBaUJxb1lDWmYwK3pJNTVhUWVBSGpJekE5WG02M3JydUF4Qlo5cHM5ejJYTg0KbFE9PSIs
DQogICJEZXNjcmlwdGlvbiI6ICJGSURPIEFsbGlhbmNlIFNhbXBsZSBVQUYgQXV0aGVudGljYXRv
ciIsDQogICJVc2VyVmVyaWZpY2F0aW9uTWV0aG9kcyI6IDIsDQogICJWYWxpZEF0dGFjaG1lbnRU
eXBlcyI6IDEsDQogICJLZXlQcm90ZWN0aW9uIjogNiwNCiAgIk1hdGNoZXJQcm90ZWN0aW9uIjog
MiwNCiAgIlNlY3VyZURpc3BsYXkiOiA0LA0KICAiU2VjdXJlRGlzcGxheUNvbnRlbnRUeXBlcyI6
IFsiaW1hZ2UvcG5nIl0sDQogICJTZWN1cmVEaXNwbGF5UE5HQ2hhcmFjdGVyaXN0aWNzIjogW1sw
LDAsMSw2NCwwLDAsMSwyMjQsMTYsMiwwLDAsMF1dLA0KICAiaXNTZWNvbmRGYWN0b3JPbmx5Ijog
ImZhbHNlIiwNCiAgIkljb24iOiAiZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFB
QU5TVWhFVWdBQUFFOEFBQUF2Q0FZQUFBQ2l3SmZjQUFBQUFYTlNSMElBcnM0YzZRQUFBQVJuUVUx
QkFBQ3gNCmp3djhZUVVBQUFBSmNFaFpjd0FBRHNNQUFBN0RBY2R2cUdRQUFBYWhTVVJCVkdoRDda
cjVieFJsR01mOUt6VEI4QU0vWUVoRTJXN3ANClFaY1dLS0JjbFNwSEFUbEVMQVJFN2tORUNDQTNG
a1dLMENLS1NDRklzS0JjZ1ZDRFdHTkVTZEFZaWR3Z2dnSkJpUmlNaEZjLzR3eTgNCjg4NHp1OU5k
bG5HVGZaSlAybjNuTysrODg5MzNmdmVCQngrUHFDekprVFV2QmJMbXBVRFd2QlRJbXBjQ1NadlhM
Q2RYOVIwNVNrMTkNCmJiNWF0ZjU5OWZHKy9lckE1NDFxNDdhUDFMTFZhOVNJeVZOVWk4SWk4ZDVr
R1RzaTMwTkZ2N2FpOW43UVpQTXdiZHlzMmVyVTJYTXENClVkeTgrWmNhTm1HaW1FOHlYTjNSVWQz
YTE4bkYwZlVsb3ZaKzBDVHpXcGQyVmorZU9tMWJFeXk2RHg0aTVwVU1HV3ZlbzUwNnEyMjcNCmR0
dVdCSXVmZnI2b1dwVjBGUE5MaG93MTc1MU5tMjFMdlBIM3JWdFdqZno2NkxmcWw4dFg3RlJsOVlG
U1hzbVNzZWI5Y2VPR2JZazcNCk1OVWNHUGc4WnNiTWU5cmZRVWFhVi9KTVg5c3FkekRDU3ZwMGta
SG1UWmc5eDdiTEhjTW5UaGIxNmVKK21WZlFxOHlhVVpRTkc2NGkNClhaKzAva3E2dU9aRk8wUXRh
dGRXS2ZYblJROTlCajkxUjVPSUZuazU0ak4wbWtVaXFsTzNYRFcrTWwrOThtS0I2dFc3cldwWmNQ
YysNCjB6ZzR0THJZbFVjODZFNmVHRGpJTXViVnBjdXNlYXJmZ0lZR1JrNmJyaFpWci9KY0h6b29M
NzU1MGplZExFeG9wV2NBcGkyWlVxaHUNCjdKTHZyVnNRVTgxemt6T1BlZW1NUll2VnVRc1g3UGJp
RFFZNUp2Wm9uZnRLKzFWWThIOXV0eDUzMGgwb2Iram1SWXFqNm91YVl2RWUNCm5XL1dsWWpwOGN3
Yk1tNjgydFB3cVcxUjR0ai8yU0gxM0lSSllsNG1vWnZYcGlTcURyN2RYdFFIeGEvUEszLytCV3NL
MWRUZ0h1NlYNCjh0UUozYndGa3dwRnJVT1E1MHMxcjNsZXZtOHpaY3ExNytCQmF3N0s4bEVLNXF6
a1llYXJrOUE4cDdQM0d6REsrbmQzRFFvdys2VUMNCjhTVk44Mml1djM4aW03TnRhWHRWMUNWcTZS
Z3c0cGtzbWJkaTNidTJEZTdZZmFCQnhjcWZ2cVByVWpGUU5UUTIybGZkVVZWVDY4clQNCkpLRjVE
blNtVWpnZHFnNG1TUzlwbXNmREpSM0c2VG9IMGlXOWFWN0xXTEhZWEtsbFREdDBMVEF0a1lJYWFt
cDFRalZ2Kyt1eUdVeFYNCmRKMEROVlhTbStiMXFSeHBsODRkZGZYMUxwMU8vZDY5dHNvZDB2czVo
R3JlOXh1OG8rZnBMUjFjR2hOVEQ2WjU3QzlLTVdYZWZKZE8NClo5NGJiOW9xZDFST25TN3FJVFR6
SGltTXFpdmJPM2cwRGRWeWszV1FCaEJ6dEszNVlLTmRPbmM4TzNhY1M2ZkRaRmdLYVhMc0VKcDUN
CnJkcmxpQnFwODljSmNzL203VHZzMHJrakdmTjRiMGtQb1puM1VKdUlPcm5aMjJ5UDFmbXZVeCtP
NWdTcWViVjFtK3pTdVlOVmhxN1QNCldiRGlMVnZsanBsTGxvcDZDTFhQKzJxdHZHTElMLzF2aW1J
U2RNQmd6U29GWnl1NlRxZCtqenhnc1BhVjlCQ3FlZS9OallrNnY2bEsNCjljd2lVYy9TVHRmMUhE
cE0zYjU5Mnk3aDNUaHg1b3pLNjlITHBZV3VBd2FxUzVjdjI2cTdjZWI4ZWZWWWFSZVAzaUZVOHpq
MWtuU3cNClpYSE1tbkNqWTBPZ2FsbzdVUWZTQ00zcVFRcjJIL1hGUDdzc1h4NDVZbDkxQnllQ2Vw
NG1vWm9IKzFmRzN4RDR0VDd4OGt3eWo4bncNCmI5ZXYyNlYwQjZkKzdINHpLdnVkQUg1MzdGanF5
ek9IZEpuSEV1em1YcS9XanhPYnZOTWJ2N25oeXdzWDJhVnNXdEM4KzQ4YUxlYXANCkU3cDV3S1pp
MEEyQVFSVjVudlI0RSt1SmMrYjYxa0FwcUlueEJnbWQvNFY1UVAvbXQxOEhEQzdzUkhmdG1ldTVs
bWhWMHJuL0FMWDINCjMyYnFkNEJGbkR4N1ZpMWNXUzJ1ZmYwSWJCNDdxZXh4bVVqOVF1dFlqdXBk
M3RZRDZhYldCQk1yaCthcE5iT0tyTkYxK3VnQ2E0cmkNClhHZndNUFB0VmlhdmhVM1lNT0FBbnVV
Yi9SMDdMMHlPU2VPYWRFODhBcHNYRkdmZjMweW5obEpnTTUxQ1U2dk45RXpnbnB2SEJGVXkNCmlW
cmFlUGl3SjUzREY1WlRabm9tRU5nODVrTlVkMm9KaTJXcHI0T21ta2ZONHg0ekhmaVZGYzhEdjhO
enVoTnFPaWRpbEd2QTZER3UNCmVad083OEFBUW42Y2lFazYrcnc1VmN2anZxTkRZUE9vSVV3YUtT
aHJ4QXVYTGxrSDRhWXVHZk1ZRGMxMFdGNVRhMzFoUEpPZmNVaHINClUvSmxJTmk2YzZlbFJZZEJw
bzYrK1lmang2MWxHTmZSbTRNRDVySjFqM0ZvR0huakRTQk5hcllVZ01MeU1zektwYjd0WHBvSGZQ
czgNCmgzV3AxTHpOZk5rNTRYeEMxd0RHVW1ZelhZZWZoNnovY0t0Vm00RUJ4YTlWUUdEellyM0xy
VU1SakhFS2trN3phRktZUUEyaEdRVTENCnorODVORldwWERya3ozdngxMEdxeFE2QnplTmJvQms1
bjhrNG5lYlJoK2sxaFdmeFRGMEQxRXlXVXM1bnYrZGdRcUtheHp1Q2RFMGkNCnNIbDAyTlE4YWgw
bVhyMTJMYTNtMGY5d2lrOSt3TE5UTVkvODZNUG84eWkzMU9meG1UNlBXb3FHOStEWnVrWW5hNTZt
U1p0NVdXU3kNCjVxVkExcndVeUpxWEFsbnpraWFpL2dIU0Q3UmtUeWlob2dBQUFBQkpSVTVFcmtK
Z2dnPT0iLA0KICAiQXNzZXJ0aW9uU2NoZW1lIjogIlVBRlYxVExWIiwNCiAgIkF1dGhlbnRpY2F0
aW9uQWxnb3JpdGhtIjogMSwNCiAgIkF0dGVzdGF0aW9uVHlwZXMiOiBbMTYzOTFdLA0KICAiVVBW
IjogW1sxLDBdXQ0KfQ0K
	 </pre>

	 <pre class="example" title="JWT Header">
{"typ":"JWT",
 "alg":"ES256"
 "x5t#S256":"7231962210d2933ec993a77b4a7203898ab74cdf974ff02d2de3f1ec7cb9de68"}
	 </pre>

	 <p>In order to produce the tbsPayload, we first need the base64url-encoded (without padding) JWT Header:</p>
	 
	 <pre class="example" title="Encoded JWT Header">
eyJ0eXAiOiJKV1QiLAogImFsZyI6IkVTMjU2IiwKICJ4NXQjUzI1NiI6IjcyMzE5NjIyMTBkMjkz
M2VjOTkzYTc3YjRhNzIwMzg5OGFiNzRjZGY5NzRmZjAyZDJkZTNmMWVjN2NiOWRlNjgifQ
	 </pre>

	 <p>then we have to append a period (".") and the base64url encoding of the <code>EncodedMetadataTOCPayload</code> 
	   (taken from the example in section <a href="#metadata-toc-format">Metadata TOC Format</a>):</p>

	 <pre class="example" title="tbsPayload">
eyJ0eXAiOiJKV1QiLAogImFsZyI6IkVTMjU2IiwKICJ4NXQjUzI1NiI6IjcyMzE5NjIyMTBkMjkz
M2VjOTkzYTc3YjRhNzIwMzg5OGFiNzRjZGY5NzRmZjAyZDJkZTNmMWVjN2NiOWRlNjgifQ.
eyAibm8iOiAxMjM0LCAibmV4dC11cGRhdGUiOiAiMzEtMDMtMjAxNCIsDQogICJlbnRyaWVzIjog
Ww0KICAgeyAiYWFpZCI6ICIxMjM0IzU2NzgiLCANCiAgICAgImhhc2giOiAiOTBkYThkYTZkZTIz
MjQ4YWJiMzRkYTBkNDg2MWY0YjMwYTc5M2UxOThhOGQ1YmFhN2Y5OGYyNjBkYjcxYWNkNCIsIA0K
ICAgICAidXJsIjogImh0dHBzOi8vZmlkb2FsbGlhbmNlLm9yZy9tZXRhZGF0YS8xMjM0JXgyM2Fi
Y2QiLCANCiAgICAgInN0YXR1cyI6ICJmaWRvQ2VydGlmaWVkIg0KICAgICAidGltZU9mTGFzdFN0
YXR1c0NoYW5nZSI6ICIiLA0KICAgICAiY2VydGlmaWNhdGlvbkRhdGUiOiAiMjAxNC0wMS0wNCIg
fSwNCiAgIHsgImFhaWQiOiAiOTg3NiM0MzIxIiwgDQogICAgICJoYXNoIjogIjc4NWQxNmRmNjQw
ZmQ3YjUwZWQxNzRjYjU2NDVjYzBmMWU3MmI3ZjE5Y2YyMjk1OTA1MmRkMjBiOTU0MWM2NGQiLA0K
ICAgICAidXJsIjogImh0dHBzOi8vYXV0aG5yLXZlbmRvci1hLmNvbS9tZXRhZGF0YS85ODc2JXgy
MzQzMjEiLA0KICAgICAic3RhdHVzIjogImZpZG9DZXJ0aWZpZWQiDQogICAgICJ0aW1lT2ZMYXN0
U3RhdHVzQ2hhbmdlIjogIjIwMTQtMDItMTkiLA0KICAgICAiY2VydGlmaWNhdGlvbkRhdGUiOiAi
MjAxNC0wMS0wNyIgfQ0KICBdDQp9DQo
	 </pre>
	 
	 <p>and finally we have to append another period (".") followed by the base64url-encoded signature.</p>
     
	 <pre class="example" title="JWT">
eyJ0eXAiOiJKV1QiLAogImFsZyI6IkVTMjU2IiwKICJ4NXQjUzI1NiI6IjcyMzE5NjIyMTBkMjkz
M2VjOTkzYTc3YjRhNzIwMzg5OGFiNzRjZGY5NzRmZjAyZDJkZTNmMWVjN2NiOWRlNjgifQ.
eyAibm8iOiAxMjM0LCAibmV4dC11cGRhdGUiOiAiMzEtMDMtMjAxNCIsDQogICJlbnRyaWVzIjog
Ww0KICAgeyAiYWFpZCI6ICIxMjM0IzU2NzgiLCANCiAgICAgImhhc2giOiAiOTBkYThkYTZkZTIz
MjQ4YWJiMzRkYTBkNDg2MWY0YjMwYTc5M2UxOThhOGQ1YmFhN2Y5OGYyNjBkYjcxYWNkNCIsIA0K
ICAgICAidXJsIjogImh0dHBzOi8vZmlkb2FsbGlhbmNlLm9yZy9tZXRhZGF0YS8xMjM0JXgyM2Fi
Y2QiLCANCiAgICAgInN0YXR1cyI6ICJmaWRvQ2VydGlmaWVkIg0KICAgICAidGltZU9mTGFzdFN0
YXR1c0NoYW5nZSI6ICIiLA0KICAgICAiY2VydGlmaWNhdGlvbkRhdGUiOiAiMjAxNC0wMS0wNCIg
fSwNCiAgIHsgImFhaWQiOiAiOTg3NiM0MzIxIiwgDQogICAgICJoYXNoIjogIjc4NWQxNmRmNjQw
ZmQ3YjUwZWQxNzRjYjU2NDVjYzBmMWU3MmI3ZjE5Y2YyMjk1OTA1MmRkMjBiOTU0MWM2NGQiLA0K
ICAgICAidXJsIjogImh0dHBzOi8vYXV0aG5yLXZlbmRvci1hLmNvbS9tZXRhZGF0YS85ODc2JXgy
MzQzMjEiLA0KICAgICAic3RhdHVzIjogImZpZG9DZXJ0aWZpZWQiDQogICAgICJ0aW1lT2ZMYXN0
U3RhdHVzQ2hhbmdlIjogIjIwMTQtMDItMTkiLA0KICAgICAiY2VydGlmaWNhdGlvbkRhdGUiOiAi
MjAxNC0wMS0wNyIgfQ0KICBdDQp9DQo.
AP-qoJ3VPzj7L6lCE1UzHzJYQnszFQ8d2hJz51sPASgyABK5VXOFnAHzBTQRRkgwGqULy6PtTyUV
zKxM0HrvoyZq
	 </pre>

	 <p class="note">The line breaks are for display purposes only.</p>
	 <p>The signature in the example above was computed with the following ECDSA key</p>

	 <pre class="example" title="ECDSA Key used for signature computation">
x: d4166ba8843d1731813f46f1af32174b5c2f6013831fb16f12c9c0b18af3a9b4
y: 861bc2f803a2241f4939bd0d8ecd34e468e42f7fdccd424edb1c3ce7c4dd04e
d: 3744c426764f331f153e182d24f133190b6393cea480a8eec1c722fce161fe2d
	 </pre>

       </section>
     </section>

     <section>
       <h3>Metadata TOC object processing rules</h3>
       <div>
	 The FIDO Server MUST follow these processing rules:
	 <ol>
	   <li>The FIDO Server MUST be able to download the latest metadata TOC object from the well-known 
	     URL, when appropriate.  The <code>nextUpdate</code> field
	     of the <a href='#metadata-toc-dictionary'>Metadata TOC</a> specifies a date when the 
	     download SHOULD occur at latest.</li>
	   <li>If the <code>x5u</code> attribute is present in the JWT Header, then:</li>
	   <ol>
	     <li>The FIDO Server MUST verify that the URL specified by the <code>x5u</code> attribute has 
	       the same web-origin as the URL used to download the metadata TOC from.  
	       The FIDO Server SHOULD ignore the file if the web-origin differs (in order to 
	       prevent loading objects from arbitrary sites).</li>
	     <li>The FIDO Server MUST download the certificate (chain) from the URL specified 
	       by the <code>x5u</code> attribute [[!JWS]].  The certificate chain MUST be 
	       verified to properly chain to the metadata TOC signing trust anchor according 
	       to [[!RFC5280]].  All certificates in the chain MUST be checked for revocation according 
	       to [[!RFC5280]].</li>  
	     <li>The FIDO Server SHOULD ignore the file if the chain cannot be verified or if one 
	       of the chain certificates is revoked.</li>
	   </ol>
	   <li>If the <code>x5u</code> attribute is missing, the chain should be retrieved from the <code>x5c</code> attribute. 
	     If that attribute is missing as well, Metadata TOC signing trust anchor 
	     is considered the TOC signing certificate chain.</li>
	   <li>Verify the signature of the Metadata TOC object using the TOC signing certificate 
	     chain (as determined by the steps above).  
	     The FIDO Server SHOULD ignore the file if the signature is invalid.  It SHOULD also 
	     ignore the file if its number (<code>no</code>) is less or equal to the number of 
	     the last Metadata TOC object cached locally.</li>
	   <li>Write the verified object to a local cache as required.</li>
	   <li>Iterate through the individual entries (of type <code>MetadataTOCPayloadEntry</code>). 
	     For each entry:</li> 
	   <ol>
 	     <li>Ignore the entry if the AAID, AAGUID or attestationCertificateKeyIdentifiers
 	       is not relevant to the relying party (e.g. not acceptable by any policy)</li> 
 	     <li>Download the metadata statement from the URL specified by the 
	       field <code>url</code>. Some authenticator vendors
	       might require authentication in order to provide access
	       to the data.  Conforming FIDO Servers SHOULD support
	       the HTTP Basic, and HTTP Digest authentication schemes,
	       as defined in [[RFC2617]].</li> 
	     <li>Check whether the status report of the authenticator model has changed compared to 
	       the cached entry by looking 
	       at the fields <code>timeOfLastStatusChange</code> and <code>statusReport</code>.  
	       Update the status of the cached entry.  It is up to the relying party
	       to specify behavior for authenticators with status reports that indicate a 
	       lack of certification, or known security issues.  
	       However, the status <code>REVOKED</code> indicates significant security issues 
	       related to such authenticators.
	       <p class="note">Authenticators with an unacceptable status should be marked accordingly.  
		 This information is required for
		 building registration and authentication policies included in the registration 
		 request and the authentication request [[UAFProtocol]].</p>
	     </li>
 	     <li>Compute the hash value of the (base64url encoding without padding of the UTF-8 encoded) metadata statement 
	       downloaded from the URL and verify the hash value to the hash specified
	       in the field <code>hash</code> of the metadata TOC object.  Ignore the 
	       downloaded metadata statement if the hash value doesn't match.</li> 
 	     <li>Update the cached metadata statement according to the dowloaded one.</li> 
	   </ol>
	 </ol>
	 
       </div>
     </section>
  </section>
</section>

<section class="informative">
  <h2>Considerations</h2>
  <p>This section describes the key considerations for designing this metadata service.
  <p><b>Need for Authenticator Metadata</b> When defining policies for
    acceptable authenticators, it is often better to describe the
    required authenticator characteristics in a generic way than to
    list individual authenticator AAIDs.  The metadata statements
    provide such information.  Authenticator metadata also provides
    the trust anchor required to verify attestation objects.  </p>
  <p>The metadata service provides a standardized method to access such metadata statements.</p>
  <p><b>Integrity and Authenticity</b> Metadata statements include
    information relevant for the security.  Some business verticals might even
    have the need to document authenticator policies and trust anchors
    used for verifying attestation objects for auditing purposes.</p>
  <p>It is important to have a strong method to verify and proof
    integrity and authenticity and the freshness of metadata
    statements.  We are using a single digital signature to protect
    the integrity and authenticity of the Metadata TOC object and we
    protect the integrity and authenticity of the individual metadata
    statements by including their cryptographic hash values into the
    Metadata TOC object.  This allows for flexible distribution of the
    metadata statements and the Metadata TOC object using standard
    content distribution networks.</p>
  <p><b>Organizational Impact</b> Authenticator vendors can delegate
    the publication of metadata statements to the metadata service in
    its entirety.  Even if authenticator vendors choose to publish
    metadata statements themselves, the effort is very limited as the
    metadata statement can be published like a normal document on a
    website.  The FIDO Alliance has control over the FIDO
    certification process and receives the metadata as part of that
    process anyway.  With this metadata service, the list of known
    authenticators needs to be updated, signed and published
    regularly.  A single signature needs to be generated in order to
    protect the integrity and authenticity of the metadata TOC object.</p>
  <p><b>Performance Impact</b> Metadata TOC objects and metadata statements can be cached by the 
    FIDO Server.</p>
  <p> The update policy can be specified by the 
    relying party. </p>
  <p>The metadata TOC object includes a date for the next scheduled update.  
    As a result there is <i>no additional impact</i> to the FIDO Server
    during FIDO Authentication or FIDO Registration operations.</p>
  <p>Updating the Metadata TOC object 
    and metadata statements can be performed asynchronously.  
    This reduces the availability requirements for the metadata service and the load for the FIDO Server.</p>
  <p>The metadata TOC object itself is relatively small as it does not contain the individual metadata statements.  
    So downloading the metadata TOC object does
    not generate excessive data traffic.</p>
  <p>Individual metadata statements are expected to change 
    less frequently than the metadata TOC object.  Only the
    modified metadata statements need be downloaded by the FIDO Server.</p>
  <p><b>Non-public Metadata Statements</b> Some authenticator vendors might want to provide access to 
    metadata statements only to their subscribed customers.</p>
  <p>
    They can publish the metadata statements on access protected URLs.  The access URL and 
    the cryptographic hash of the metadata statement is included
    in the metadata TOC object.  </p>
  <p><b>High Security Environments</b> Some high security environments might only trust 
    internal policy authorities.  FIDO Servers in such environments
    could be restricted to use metadata TOC objects from a proprietary trusted source only.  
    The metadata service is the baseline for most relying parties.</p>
  <p><b>Extended Authenticator Information</b> Some relying parties might want additional information 
    about authenticators before accepting them.  The 
    policy configuration is under control of the relying party, so it is possible to 
    only accept authenticators for which additional data is available
    and meets the requirements.</p>
</section>


</body>
</html>
